<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>I AM HUMAN — Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#000; --fg:#fff;
  --alert:#ff2f4d;   /* red blink for date */
  --neon:#7EE7FF;    /* cyan for #next_transmission */
}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family:"Share Tech Mono","Courier New",monospace;
  display:flex; align-items:center; justify-content:center;
  padding:24px; overflow:hidden;
}
.wrap{ width:min(92vw,780px); display:grid; gap:28px; place-items:center; }
pre{ margin:0; max-width:64ch; white-space:pre-wrap; font-size:clamp(14px,2.6vw,19px); line-height:1.55; }

.cursor{display:inline-block; width:.65ch;}
.blink{animation:blink .55s step-end infinite}
@keyframes blink{50%{opacity:0}}

.tag-ntx{
  color:var(--neon);
  text-shadow:
    0 0 3px rgba(126,231,255,.95),
    0 0 6px rgba(126,231,255,.75),
    0 0 12px rgba(126,231,255,.55),
    0 0 20px rgba(126,231,255,.35);
}
.blink-2026{
  color:#fff;
  text-shadow:0 0 3px var(--alert),0 0 6px var(--alert),0 0 12px var(--alert);
  animation:twinkle .9s step-end infinite;
}
@keyframes twinkle{50%{opacity:0}}

.pulse-flash{ animation:pulseFlash 1s ease-out 1; }
@keyframes pulseFlash{
  0%{ text-shadow:none }
  30%{ text-shadow:0 0 6px rgba(255,255,255,.9), 0 0 14px rgba(255,255,255,.7) }
  100%{ text-shadow:none }
}

/* USB container: inserted only after text completes */
.usb{width:min(75vw,520px); aspect-ratio:16/9; filter:contrast(125%) brightness(102%)}
.usb video, .usb img{width:100%; height:100%; object-fit:contain; display:block}

@media (prefers-reduced-motion:reduce){
  .blink,.blink-2026,.pulse-flash{animation:none !important; text-shadow:none !important}
}
</style>
</head>
<body>
  <div class="wrap">
    <pre id="out"></pre>
    <!-- USB holder will be appended here AFTER the final line -->
    <div id="mediaMount"></div>
  </div>

<script>
const SPEED = 20; // ms/char

const LINES = [
  "> searching static…",                          // 0: type then wait 2.5s
  "",                                             // 1: blank line BEFORE pulse
  "a pulse hums faintly beneath the noise",       // 2: pulse line (glow once)
  "",                                             // 3: blank line AFTER pulse
  "> status : \\u0394- LOST SP//ARK_01",          // 4
  "> signal : sub-bass residue",                  // 5
  "> bpm : unknown",                              // 6
  "next transmission : march 2026"                // 7 -> #next_transmission + red blink
].map(s=>s.replace("\\u0394","Δ"));

const out = document.getElementById("out");
const mount = document.getElementById("mediaMount");

function typeLine(text,{speed=SPEED,pauseAfter=0,showCursor=false,flashAfter=false}={}){
  return new Promise(res=>{
    const line=document.createElement("div");
    const span=document.createElement("span");
    line.appendChild(span);
    let cursor=null;
    if(showCursor){
      cursor=document.createElement("span");
      cursor.className="cursor blink";
      cursor.textContent="▮";
      line.appendChild(cursor);
    }
    out.appendChild(line);
    let i=0;
    (function tick(){
      // live replacements for tag/date when they appear
      const partial = text.slice(0,++i)
        .replace(/^\s*next transmission\s*:/i,'<span class="tag-ntx">#next_transmission</span> : ')
        .replace(/march 2026/gi,'<span class="blink-2026">march 2026</span>');
      span.innerHTML = partial;
      if(i<text.length){
        setTimeout(tick,speed);
      }else{
        if(flashAfter){ span.classList.add('pulse-flash'); }
        setTimeout(res,pauseAfter);
      }
    })();
  });
}

(async function run(){
  // 0) type "searching static…" then wait 2.5s
  await typeLine(LINES[0], {showCursor:true, pauseAfter:2500});

  // 1) blank line
  await typeLine(LINES[1]);

  // 2) pulse line, glow once after typing
  await typeLine(LINES[2], {flashAfter:true, pauseAfter:200});

  // 3) blank line
  await typeLine(LINES[3]);

  // 4–6) system lines (with cursors)
  await typeLine(LINES[4], {showCursor:true, pauseAfter:60});
  await typeLine(LINES[5], {showCursor:true, pauseAfter:60});
  await typeLine(LINES[6], {showCursor:true, pauseAfter:160});

  // 7) transmission line with neon tag + blinking date
  const final = document.createElement("div");
  out.appendChild(final);
  final.innerHTML = LINES[7]
    .replace(/^\s*next transmission\s*:/i,'<span class="tag-ntx">#next_transmission</span> : ')
    .replace(/march 2026/gi,'<span class="blink-2026">march 2026</span>');

  // AFTER text completes: add USB video, play twice, then swap to png
  const usbDiv = document.createElement('div');
  usbDiv.className = 'usb';
  const vid = document.createElement('video');
  vid.id = 'usbvid';
  vid.src = 'usb.mp4';
  vid.muted = true;
  vid.playsInline = true;
  vid.autoplay = true;
  // no loop — we’ll handle repeats
  usbDiv.appendChild(vid);
  mount.appendChild(usbDiv);

  let plays = 0;
  vid.addEventListener('ended', () => {
    plays++;
    if(plays < 2){
      try{ vid.currentTime = 0; vid.play(); }catch(e){}
    }else{
      const img = new Image();
      img.src = 'usb.png';
      img.alt = 'recovered usb (still)';
      img.onload = () => { usbDiv.replaceChildren(img); };
      // fallback swap even if load event is delayed
      setTimeout(()=>{ if(usbDiv.firstChild !== img) usbDiv.replaceChildren(img); }, 600);
    }
  });
})();
</script>
</body>
</html>
